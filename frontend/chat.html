<!DOCTYPE html>
<html lang="en">
  <head>    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POLYMIND - The Global AI Chatbot</title>    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="manifest" href="/static/site.webmanifest" />    <meta name="theme-color" content="#3b82f6" />
    
    <!-- SEO and Social Meta Tags -->
    <meta name="description" content="POLYMIND - Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    <meta name="keywords" content="AI, chatbot, artificial intelligence, machine learning, coding assistant, data analysis, creative writing" />
    <meta name="author" content="POLYMIND Team" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://polymind.ai/" />
    <meta property="og:title" content="POLYMIND - The Global AI Chatbot" />
    <meta property="og:description" content="Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://polymind.ai/" />
    <meta property="twitter:title" content="POLYMIND - The Global AI Chatbot" />
    <meta property="twitter:description" content="Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    
    <!-- Inline SVG Favicon as fallback -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%233b82f6;stop-opacity:1' /><stop offset='100%' style='stop-color:%236366f1;stop-opacity:1' /></linearGradient></defs><rect width='32' height='32' rx='8' fill='url(%23grad)'/><path d='M16 6c-1.5 0-2.8.6-3.8 1.6-.4-.2-.9-.3-1.4-.3-1.7 0-3 1.3-3 3 0 .5.1 1 .3 1.4C6.6 12.2 6 13.5 6 15c0 1.1.3 2.1.8 3-.5.9-.8 1.9-.8 3 0 1.5.6 2.8 1.6 3.8-.2.4-.3.9-.3 1.4 0 1.7 1.3 3 3 3 .5 0 1-.1 1.4-.3C12.2 25.4 13.5 26 15 26h2c1.5 0 2.8-.6 3.8-1.6.4.2.9.3 1.4.3 1.7 0 3-1.3 3-3 0-.5-.1-1-.3-1.4.9-1 1.6-2.3 1.6-3.8 0-1.1-.3-2.1-.8-3 .5-.9.8-1.9.8-3 0-1.5-.6-2.8-1.6-3.8.2-.4.3-.9.3-1.4 0-1.7-1.3-3-3-3-.5 0-1 .1-1.4.3C18.8 6.6 17.5 6 16 6z' fill='white' opacity='0.9'/><circle cx='12' cy='12' r='1.5' fill='white'/><circle cx='20' cy='12' r='1.5' fill='white'/><circle cx='16' cy='16' r='1.5' fill='white'/><circle cx='12' cy='20' r='1.5' fill='white'/><circle cx='20' cy='20' r='1.5' fill='white'/></svg>" type="image/svg+xml" />

    <!-- Import Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Import Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Import Chat Styles -->
    <link rel="stylesheet" href="/static/chat.css" />
  </head>
  <body data-theme="dark">
    <!-- Welcome Carousel (Initial Onboarding) -->
    <div class="welcome-carousel" id="welcome-carousel">
      <div class="carousel-content">
        <i class="fas fa-brain"></i>
        <h2>Welcome to POLYMIND</h2>
        <p>
          Your intelligent AI assistant, ready to revolutionize the way you
          work. Fast, smart, and secure.
        </p>
      </div>
      <div class="carousel-pagination">
        <span class="carousel-dot active" data-slide="0"></span>
        <span class="carousel-dot" data-slide="1"></span>
        <span class="carousel-dot" data-slide="2"></span>
      </div>
      <button class="start-chat-btn" id="start-chat-btn">
        Start Chatting Now
      </button>
    </div>

    <div class="polymind-workspace" id="polymind-workspace">
      <!-- Sidebar Overlay for Mobile -->
      <div class="sidebar-overlay" id="sidebar-overlay"></div>

      <!-- ===== 1. SIDEBAR ===== -->
      <aside class="sidebar">
        <header class="sidebar-header">
          <span class="logo"><i class="fas fa-brain"></i>POLYMIND</span>
          <button
            class="close-sidebar-btn"
            id="close-sidebar-btn"
            title="Close Sidebar"
          >
            <i class="fas fa-times"></i>
          </button>
        </header>

        <button class="new-chat-btn">
          <i class="fas fa-plus"></i> New Chat
        </button>        <!-- Agent Selector -->
        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Active Agent</h3>
          <div class="agent-selector-wrapper">            <select id="agentSelector" class="agent-selector">
              <option value="deepseek">DeepSeek V3</option>
              <option value="coding">Coding Expert</option>
              <option value="analysis">Data Analyst</option>
              <option value="creative">Creative Writer</option>
            </select>
          </div>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Conversations</h3>
          <ul class="nav-list" id="conversation-list">
            <li>
              <a href="#" class="active" data-conv-id="1"
                ><i class="fas fa-comment"></i> X-25 Report Analysis</a
              >
            </li>
            <li>
              <a href="#" data-conv-id="2"
                ><i class="fas fa-comment"></i> Logistics Planning</a
              >
            </li>
            <li>
              <a href="#" data-conv-id="3"
                ><i class="fas fa-comment"></i> Document Translation</a
              >
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">AI Agents</h3>
          <ul class="nav-list" id="agent-list">
            <li>
              <a href="#" data-agent="Strategos"
                ><i class="fas fa-chess-king"></i> Strategos</a
              >
            </li>
            <li>
              <a href="#" data-agent="Analytica"
                ><i class="fas fa-chart-pie"></i> Analytica</a
              >
            </li>
            <li>
              <a href="#" data-agent="Logistix"
                ><i class="fas fa-truck"></i> Logistix</a
              >
            </li>
            <li>
              <a href="#" data-agent="Linguist"
                ><i class="fas fa-language"></i> Linguist</a
              >
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Knowledge Base</h3>
          <ul class="nav-list" id="knowledge-base-list">
            <li>
              <a href="#"><i class="fas fa-file-alt"></i> Report_X-25.pdf</a>
            </li>
            <li>
              <a href="#"><i class="fas fa-file-word"></i> Supply_Chain.docx</a>
            </li>
            <li>
              <a href="#"><i class="fas fa-database"></i> Personnel_DB.sql</a>
            </li>
          </ul>
        </div>

        <footer class="sidebar-footer">
          <div class="user-profile">
            <img src="https://i.pravatar.cc/80?u=commander" alt="User Avatar" />
            <div class="user-info">
              <span class="name">Commander Bravo</span>
              <span class="role">Administrator</span>
            </div>
          </div>
          <div class="global-settings">
            <button title="Change Language">
              <i class="fas fa-globe"></i> EN
            </button>
            <button title="Help & Support">
              <i class="fas fa-question-circle"></i> Help
            </button>
            <button title="Settings" id="theme-toggle">
              <i class="fas fa-cog"></i> Settings
            </button>
          </div>
        </footer>
      </aside>

      <!-- ===== 2. CHAT INTERFACE ===== -->
      <main class="chat-interface">
        <header class="chat-header">          <div class="chat-header-left">
            <button
              class="mobile-menu-toggle"
              id="mobile-menu-toggle"
              title="Open Sidebar"
            >
              <i class="fas fa-bars"></i>
            </button>
            <div class="chat-header-title" id="chat-header-title">
              <i class="fas fa-chess-king"></i>
              <span>Chat with Strategos</span>
            </div>
            <!-- Connection Status -->
            <div class="connection-status connected" 
                 id="connectionStatus" 
                 role="status" 
                 aria-live="polite"
                 aria-label="Connection status"
                 data-status="connected">
              <span class="status-dot" aria-hidden="true"></span>
              <span class="status-text" id="statusText">Đã kết nối</span>
            </div>
          </div>
          <div class="chat-header-actions">
            <button title="Agent Info">
              <i class="fas fa-info-circle"></i>
            </button>
            <button title="Export Chat"><i class="fas fa-download"></i></button>
            <button title="Clear Chat"><i class="fas fa-trash-alt"></i></button>
          </div>
        </header>

        <div class="chat-log" id="chat-log">          <!-- AI Welcome Message -->
          <div class="chat-message ai">
            <div class="avatar"><i class="fas fa-robot"></i></div>
            <div class="message-content">
              <p>
                Strategos ready for commands. How can I assist with your
                mission?
              </p>
              <span class="message-meta">Strategos • <span id="welcomeTime">--:--:--</span></span>
            </div>
          </div>

          <!-- User Message Example -->
          <div class="chat-message user">
            <div class="avatar">CB</div>
            <div class="message-content">
              <p>
                Analyze key strengths and weaknesses in X-25 Report. Propose 3
                strategic action plans.
              </p>
              <div class="message-actions">
                <button><i class="fas fa-thumbs-up"></i></button>
                <button><i class="fas fa-thumbs-down"></i></button>
                <button>Revise</button>
              </div>
              <span class="message-meta">Commander Bravo • 10:32</span>
            </div>
          </div>

          <!-- AI Typing Indicator (Template) -->
          <div
            class="chat-message ai typing-indicator"
            id="typing-indicator"
            style="display: none"
          >
            <div class="avatar"><i class="fas fa-robot"></i></div>
            <div class="message-content">
              <div class="typing-indicator">
                <span></span><span></span><span></span>
              </div>
            </div>
          </div>
        </div>

        <div class="chat-input-area">
          <div class="quick-reply-suggestions" id="quick-reply-suggestions">
            <button>What are my top priorities?</button>
            <button>Summarize recent intel.</button>
            <button>Propose next steps.</button>
          </div>
          <form class="chat-input-form" id="chat-form">
            <button type="button" title="Voice Input">
              <i class="fas fa-microphone"></i>
            </button>
            <textarea
              id="chat-input"
              placeholder="You need help today?"
              rows="1"
            ></textarea>
            <div class="input-actions">
              <button type="button" title="Attach File">
                <i class="fas fa-paperclip"></i>
              </button>
              <button type="button" title="Emoji">
                <i class="fas fa-smile"></i>
              </button>
              <button type="submit" class="send-btn" title="Send (Enter)">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>          </form>
          <div class="input-footer">
            <div class="char-count" id="charCount">0/2000</div>
          </div>
          <div class="quick-tip">
            Quick Tip: Type <kbd>@</kbd> to call a command or <kbd>/</kbd> to
            see command list.
          </div>
        </div>
      </main>

      <!-- ===== 3. CONTEXT PANEL ===== -->
      <aside class="context-panel" id="context-panel">
        <header class="context-header">
          <i class="fas fa-info-circle"></i> <span>Agent Information</span>
        </header>
        <div class="context-content" id="context-content">
          <!-- Content will be dynamically inserted here by JS -->
        </div>
      </aside>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const chatLog = document.getElementById("chat-log");
        const chatForm = document.getElementById("chat-form");
        const chatInput = document.getElementById("chat-input");
        const typingIndicator = document.getElementById("typing-indicator");
        const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
        const closeSidebarBtn = document.getElementById("close-sidebar-btn");
        const workspace = document.getElementById("polymind-workspace");
        const sidebarOverlay = document.getElementById("sidebar-overlay");
        const agentLinks = document.querySelectorAll("#agent-list a");
        const conversationLinks = document.querySelectorAll(
          "#conversation-list a"
        ); // New
        const chatHeaderTitleSpan = document
          .getElementById("chat-header-title")
          .querySelector("span");
        const chatHeaderIcon = document
          .getElementById("chat-header-title")
          .querySelector("i");
        const contextPanel = document.getElementById("context-panel");
        const contextContent = document.getElementById("context-content");
        const quickReplySuggestions = document.getElementById(
          "quick-reply-suggestions"
        );
        const themeToggleBtn = document.getElementById("theme-toggle");

        const welcomeCarousel = document.getElementById("welcome-carousel");
        const startChatBtn = document.getElementById("start-chat-btn");
        const carouselDots = document.querySelectorAll(".carousel-dot");

        // --- Agent Information Database ---
        const agentDatabase = {
          Strategos: {
            icon: "fa-chess-king",
            description:
              "Specialized in strategic planning, intelligence analysis, and scenario simulation. Optimized for high-level decision making.",
            capabilities: [
              "SWOT Analysis",
              "Scenario Simulation",
              "Campaign Planning",
              "Risk Management",
            ],
            quickReplies: [
              "What are my top priorities?",
              "Summarize recent intel.",
              "Propose next steps.",
            ],
          },
          Analytica: {
            icon: "fa-chart-pie",
            description:
              "Focused on big data analysis, pattern recognition, and complex information visualization.",
            capabilities: [
              "Big Data Processing",
              "Predictive Analytics",
              "Entity Recognition",
              "Data Visualization",
            ],
            quickReplies: [
              "Show me data trends.",
              "Analyze this dataset.",
              "Identify key outliers.",
            ],
          },
          Logistix: {
            icon: "fa-truck",
            description:
              "Manages and optimizes supply chains, resource coordination, and logistics planning.",
            capabilities: [
              "Route Optimization",
              "Inventory Management",
              "Demand Forecasting",
              "Asset Coordination",
            ],
            quickReplies: [
              "Optimize delivery routes.",
              "Check inventory levels.",
              "Forecast demand for Q3.",
            ],
          },
          Linguist: {
            icon: "fa-language",
            description:
              "Specializes in translation, natural language processing, and multilingual text analysis in real-time.",
            capabilities: [
              "Military-grade Translation",
              "Text Summarization",
              "Sentiment Analysis",
              "Multilingual Communication",
            ],
            quickReplies: [
              "Translate this text.",
              "Summarize this document.",
              "Analyze sentiment here.",
            ],
          },
        };

        // --- State ---
        let currentAgent = "Strategos"; // Default agent
        let currentTheme = localStorage.getItem("theme") || "dark"; // Get theme from localStorage or default to dark
        let currentCarouselSlide = 0;
        const carouselSlides = [
          {
            icon: "fas fa-brain",
            title: "Welcome to POLYMIND",
            text: "Your intelligent AI assistant, ready to revolutionize the way you work. Fast, smart, and secure.",
          },
          {
            icon: "fas fa-rocket",
            title: "Boost Your Productivity",
            text: "Leverage specialized AI agents for strategic planning, data analysis, logistics, and more.",
          },
          {
            icon: "fas fa-shield-alt",
            title: "Secure & Reliable",
            text: "Your data is protected with military-grade encryption. Focus on your mission, we handle the rest.",
          },
        ];

        // --- Functions ---

        /**
         * Appends a message to the chat log
         * @param {string} sender - 'user' or 'ai'
         * @param {string} text - The message content
         * @param {boolean} showFeedback - Whether to show feedback buttons for AI messages
         */
        const addMessage = (sender, text, showFeedback = false) => {
          const messageEl = document.createElement("div");
          messageEl.classList.add("chat-message", sender);

          const avatarContent =
            sender === "user" ? "CB" : '<i class="fas fa-robot"></i>';
          const senderName =
            sender === "user" ? "Commander Bravo" : currentAgent;
          const time = new Date().toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          let feedbackHtml = "";
          if (sender === "ai" && showFeedback) {
            feedbackHtml = `
                <div class="message-actions">
                    <button class="feedback-btn" data-feedback="up" title="Good response"><i class="fas fa-thumbs-up"></i></button>
                    <button class="feedback-btn" data-feedback="down" title="Poor response"><i class="fas fa-thumbs-down"></i></button>
                    <button class="feedback-btn" data-feedback="revise" title="Suggest revision">Revise</button>
                </div>
            `;
          }

          messageEl.innerHTML = `
            <div class="avatar">${avatarContent}</div>
            <div class="message-content">
                <p>${text}</p>
                ${feedbackHtml}
                <span class="message-meta">${senderName} • ${time}</span>
            </div>
        `;
          chatLog.appendChild(messageEl);
          chatLog.scrollTop = chatLog.scrollHeight;

          // Add event listeners for feedback buttons
          if (sender === "ai" && showFeedback) {
            messageEl.querySelectorAll(".feedback-btn").forEach((button) => {
              button.addEventListener("click", (e) => {
                alert(
                  `Feedback recorded for AI message: ${e.currentTarget.dataset.feedback}`
                );
                // Disable buttons after feedback
                e.currentTarget.parentNode
                  .querySelectorAll("button")
                  .forEach((btn) => (btn.disabled = true));
              });
            });
          }
        };

        /**
         * Simulates an AI response after a delay
         */
        const simulateAIResponse = (userInput) => {
          typingIndicator.style.display = "flex";
          chatLog.scrollTop = chatLog.scrollHeight;

          setTimeout(() => {
            typingIndicator.style.display = "none";
            let response = "Request received. Processing...";

            if (
              userInput.toLowerCase().includes("hello") ||
              userInput.toLowerCase().includes("hi")
            ) {
              response = `Hello Commander. Agent ${currentAgent} at your service. How can I assist you further?`;
            } else if (userInput.toLowerCase().includes("analyze")) {
              response = `Analysis complete based on available data. Preliminary results show 3 risk points and 2 potential opportunities. Would you like details?`;
            } else if (userInput.toLowerCase().includes("plan")) {
              response = `Initiating plan development. Key considerations include: resources, timeline, and strategic objectives. Please provide additional details.`;
            } else if (userInput.toLowerCase().includes("summarize")) {
              response = `Summary generated. The key takeaways are: [Point 1], [Point 2], and [Point 3].`;
            } else if (userInput.toLowerCase().includes("optimize")) {
              response = `Optimization algorithm initiated. This may take a moment.`;
            } else if (userInput.toLowerCase().includes("translate")) {
              response = `Translation complete. Please provide the text for direct translation or attachment.`;
            } else if (
              userInput.toLowerCase().includes("what are my top priorities")
            ) {
              response = `Based on your recent activities and open tasks, your top priorities are: 1) Finalize X-25 report, 2) Review Q3 logistics plan, and 3) Brief the team on new intel.`;
            }

            addMessage("ai", response, true); // Show feedback buttons for AI responses
          }, 1500 + Math.random() * 1000);
        };

        /**
         * Updates the context panel with agent information
         */
        const updateContextPanel = (agentName) => {
          const agentInfo = agentDatabase[agentName];
          if (!agentInfo) {
            contextContent.innerHTML = `<div class="placeholder">No information available for this agent.</div>`;
            return;
          }

          const capabilitiesList = agentInfo.capabilities
            .map((cap) => `<li><i class="fas fa-check-circle"></i> ${cap}</li>`)
            .join("");

          contextContent.innerHTML = `
            <div class="agent-details">
                <div class="detail-item">
                    <strong>Description</strong>
                    <p>${agentInfo.description}</p>
                </div>
                <div class="detail-item">
                    <strong>Core Capabilities</strong>
                    <ul class="capabilities-list">${capabilitiesList}</ul>
                </div>
            </div>
        `;
        };

        /**
         * Updates the quick reply suggestions based on the current agent
         */
        const updateQuickReplySuggestions = (agentName) => {
          const agentInfo = agentDatabase[agentName];
          quickReplySuggestions.innerHTML = ""; // Clear existing
          if (agentInfo && agentInfo.quickReplies) {
            agentInfo.quickReplies.forEach((suggestion) => {
              const button = document.createElement("button");
              button.textContent = suggestion;
              button.addEventListener("click", () => {
                chatInput.value = suggestion;
                chatInput.dispatchEvent(new Event("input")); // Trigger resize
                chatInput.focus();
              });
              quickReplySuggestions.appendChild(button);
            });
          }
        };

        /**
         * Handles form submission
         */
        chatForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const userInput = chatInput.value.trim();
          if (userInput) {
            addMessage("user", userInput);
            chatInput.value = "";
            chatInput.style.height = "auto"; // Reset height
            simulateAIResponse(userInput);
          }
        });

        /**
         * Handles keyboard shortcuts
         */
        chatInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            chatForm.dispatchEvent(new Event("submit"));
          }
        });

        /**
         * Auto-resizes the textarea
         */
        chatInput.addEventListener("input", () => {
          chatInput.style.height = "auto";
          chatInput.style.height = `${chatInput.scrollHeight}px`;
        });

        /**
         * Toggles the sidebar on mobile
         */
        const toggleSidebar = () => {
          workspace.classList.toggle("sidebar-open");
        };
        mobileMenuToggle.addEventListener("click", toggleSidebar);
        closeSidebarBtn.addEventListener("click", toggleSidebar); // Close button in sidebar header
        sidebarOverlay.addEventListener("click", toggleSidebar);

        /**
         * Handles switching between AI agents
         */
        agentLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();

            // Remove active class from all agent and conversation links
            agentLinks.forEach((l) => l.classList.remove("active"));
            conversationLinks.forEach((l) => l.classList.remove("active"));

            // Add active class to the clicked agent link
            link.classList.add("active");

            // Update state and UI
            currentAgent = link.dataset.agent;
            const agentInfo = agentDatabase[currentAgent];

            chatHeaderTitleSpan.textContent = `Chat with ${currentAgent}`;
            chatHeaderIcon.className = `fas ${agentInfo.icon}`;

            // Clear chat and add welcome message
            chatLog.innerHTML = "";
            addMessage(
              "ai",
              `Agent ${currentAgent} ready for commands. How may I assist you?`
            );

            // Update context panel
            updateContextPanel(currentAgent);

            // Update quick reply suggestions
            updateQuickReplySuggestions(currentAgent);

            // Close sidebar on mobile after selection
            if (workspace.classList.contains("sidebar-open")) {
              toggleSidebar();
            }
          });
        });

        /**
         * Handles switching between conversations (dummy functionality)
         */
        conversationLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();

            // Remove active class from all agent and conversation links
            agentLinks.forEach((l) => l.classList.remove("active"));
            conversationLinks.forEach((l) => l.classList.remove("active"));

            // Add active class to the clicked conversation link
            link.classList.add("active");

            const convName = link.textContent.trim();
            chatHeaderTitleSpan.textContent = convName;
            chatHeaderIcon.className = `fas fa-comment`; // Generic icon for conversations

            // Simulate loading conversation history
            chatLog.innerHTML = "";
            addMessage("ai", `Loading conversation: "${convName}".`);
            setTimeout(() => {
              addMessage("user", `What did we discuss about ${convName}?`);
              setTimeout(() => {
                addMessage(
                  "ai",
                  `In this conversation, we focused on the key aspects of "${convName}". What specific details are you looking for?`
                );
              }, 1000);
            }, 500);

            // Clear context panel for general conversations
            contextContent.innerHTML = `<div class="placeholder">This is a general conversation. Select an AI Agent to see its details.</div>`;
            quickReplySuggestions.innerHTML = ""; // Clear quick replies for general chat
            if (workspace.classList.contains("sidebar-open")) {
              toggleSidebar();
            }
          });
        });

        /**
         * Toggles between dark and light themes
         */
        const toggleTheme = () => {
          const newTheme =
            document.body.dataset.theme === "dark" ? "light" : "dark";
          document.body.dataset.theme = newTheme;
          localStorage.setItem("theme", newTheme);
          // Update the icon for theme toggle button
          themeToggleBtn.querySelector("i").className =
            newTheme === "dark" ? "fas fa-moon" : "fas fa-sun";
        };
        themeToggleBtn.addEventListener("click", toggleTheme);

        /**
         * Welcome Carousel Logic
         */
        const updateCarouselSlide = (index) => {
          currentCarouselSlide = index;
          const slide = carouselSlides[index];
          welcomeCarousel.querySelector(".carousel-content i").className =
            slide.icon;
          welcomeCarousel.querySelector(".carousel-content h2").textContent =
            slide.title;
          welcomeCarousel.querySelector(".carousel-content p").textContent =
            slide.text;

          carouselDots.forEach((dot, idx) => {
            if (idx === index) {
              dot.classList.add("active");
            } else {
              dot.classList.remove("active");
            }
          });
        };

        carouselDots.forEach((dot) => {
          dot.addEventListener("click", (e) => {
            const slideIndex = parseInt(e.target.dataset.slide);
            updateCarouselSlide(slideIndex);
          });
        });

        startChatBtn.addEventListener("click", () => {
          welcomeCarousel.classList.add("hidden");
          // Ensure initial chat agent and conversation are active
          document
            .querySelector('#agent-list a[data-agent="Strategos"]')
            .click();
        });

        // --- Initial Setup ---

        // Apply saved theme
        document.body.dataset.theme = currentTheme;
        themeToggleBtn.querySelector("i").className =
          currentTheme === "dark" ? "fas fa-moon" : "fas fa-sun";

        // Check if user has visited before or if it's explicitly set to skip carousel
        const hasVisited = localStorage.getItem("hasVisitedPolymind");
        if (!hasVisited) {
          welcomeCarousel.classList.remove("hidden");
          updateCarouselSlide(0); // Show first slide initially
          localStorage.setItem("hasVisitedPolymind", "true");
        } else {
          welcomeCarousel.classList.add("hidden");
          // If no carousel, ensure initial agent and context are set up
          updateContextPanel(currentAgent);
          updateQuickReplySuggestions(currentAgent);
          // Set Strategos as active by default if starting directly in chat
          document
            .querySelector('#agent-list a[data-agent="Strategos"]')
            .classList.add("active");
        }
      });
    </script>
    <script src="/static/chat.js"></script>
  </body>
</html>
