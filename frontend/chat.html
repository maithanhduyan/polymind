<!DOCTYPE html>
<html lang="en">
  <head>    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POLYMIND - The Global AI Chatbot</title>    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="manifest" href="/static/site.webmanifest" />    <meta name="theme-color" content="#3b82f6" />
    
    <!-- SEO and Social Meta Tags -->
    <meta name="description" content="POLYMIND - Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    <meta name="keywords" content="AI, chatbot, artificial intelligence, machine learning, coding assistant, data analysis, creative writing" />
    <meta name="author" content="POLYMIND Team" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://polymind.ai/" />
    <meta property="og:title" content="POLYMIND - The Global AI Chatbot" />
    <meta property="og:description" content="Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://polymind.ai/" />
    <meta property="twitter:title" content="POLYMIND - The Global AI Chatbot" />
    <meta property="twitter:description" content="Advanced AI chatbot platform with multiple specialized agents for coding, analysis, creative writing, and general assistance." />
    
    <!-- Inline SVG Favicon as fallback -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%233b82f6;stop-opacity:1' /><stop offset='100%' style='stop-color:%236366f1;stop-opacity:1' /></linearGradient></defs><rect width='32' height='32' rx='8' fill='url(%23grad)'/><path d='M16 6c-1.5 0-2.8.6-3.8 1.6-.4-.2-.9-.3-1.4-.3-1.7 0-3 1.3-3 3 0 .5.1 1 .3 1.4C6.6 12.2 6 13.5 6 15c0 1.1.3 2.1.8 3-.5.9-.8 1.9-.8 3 0 1.5.6 2.8 1.6 3.8-.2.4-.3.9-.3 1.4 0 1.7 1.3 3 3 3 .5 0 1-.1 1.4-.3C12.2 25.4 13.5 26 15 26h2c1.5 0 2.8-.6 3.8-1.6.4.2.9.3 1.4.3 1.7 0 3-1.3 3-3 0-.5-.1-1-.3-1.4.9-1 1.6-2.3 1.6-3.8 0-1.1-.3-2.1-.8-3 .5-.9.8-1.9.8-3 0-1.5-.6-2.8-1.6-3.8.2-.4.3-.9.3-1.4 0-1.7-1.3-3-3-3-.5 0-1 .1-1.4.3C18.8 6.6 17.5 6 16 6z' fill='white' opacity='0.9'/><circle cx='12' cy='12' r='1.5' fill='white'/><circle cx='20' cy='12' r='1.5' fill='white'/><circle cx='16' cy='16' r='1.5' fill='white'/><circle cx='12' cy='20' r='1.5' fill='white'/><circle cx='20' cy='20' r='1.5' fill='white'/></svg>" type="image/svg+xml" />

    <!-- Import Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Import Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />    <!-- Import Chat Styles -->
    <link rel="stylesheet" href="/static/chat.css" />
    
    <!-- Fix Chat Log Scrolling - Generated by Copilot -->
    <style>      /* Ensure proper flexbox layout for chat interface - Generated by Copilot */
      .chat-interface {
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        flex: 1;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
        /* Workspace layout with responsive context panel - Generated by Copilot */
      .polymind-workspace {
        display: flex;
        flex-direction: row;
        height: 100vh;
        overflow: hidden;
      }
      
      /* Sidebar takes fixed width */
      .sidebar {
        flex: 0 0 280px;
        min-width: 280px;
      }
      
      /* Context panel takes fixed width when expanded */
      .context-panel:not(.collapsed) {
        flex: 0 0 320px;
        min-width: 320px;
      }
      
      /* Context panel takes no space when collapsed */
      .context-panel.collapsed {
        flex: 0 0 0;
        min-width: 0;
      }
      
      /* Chat interface auto-expands to fill remaining space */
      .chat-interface {
        flex: 1 1 auto;
        min-width: 0;
      }
        /* Make chat-log scrollable with optimized height - Generated by Copilot */
      .chat-log {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 1rem;
        margin-bottom: 0;
        max-height: calc(100vh - 140px); /* Adjusted for compact footer */
        scroll-behavior: smooth;
      }
      
      /* Ensure chat input area stays at bottom */
      .chat-input-area {
        flex-shrink: 0;
        border-top: 1px solid var(--border-color, #e5e7eb);
        background: var(--bg-primary, #ffffff);
      }
        /* Custom scrollbar for chat-log */
      .chat-log::-webkit-scrollbar {
        width: 6px;
      }
      
      .chat-log::-webkit-scrollbar-track {
        background: var(--bg-secondary, #f9fafb);
        border-radius: 3px;
      }
      
      .chat-log::-webkit-scrollbar-thumb {
        background: var(--border-color, #d1d5db);
        border-radius: 3px;
      }
      
      .chat-log::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary, #6b7280);
      }
      
      /* Typing cursor effect for streaming AI responses */
      .typing-cursor::after {
        content: '|';
        display: inline-block;
        animation: typing-cursor-blink 1s infinite;
        color: var(--primary-color, #3b82f6);
        font-weight: normal;
        margin-left: 2px;
      }
      
      @keyframes typing-cursor-blink {
        0%, 50% {
          opacity: 1;
        }
        51%, 100% {
          opacity: 0;
        }
      }      
      /* Ensure messages don't overflow */
      .chat-message {
        margin-bottom: 1rem;
        max-width: 100%;
        word-wrap: break-word;
      }
      
      /* Optimized input footer - Generated by Copilot */
      .input-footer.compact {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 1rem;
        min-height: 2rem;
        background: var(--bg-secondary, #f8fafc);
        border-top: 1px solid var(--border-color, #e2e8f0);
        font-size: 0.75rem;
        color: var(--text-secondary, #64748b);
      }
      
      .input-footer-left {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .input-footer-right {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      
      .char-count {
        font-family: 'Inter', monospace;
        font-weight: 500;
      }
      
      .tips-toggle {
        background: none;
        border: none;
        padding: 0.25rem;
        border-radius: 0.25rem;
        cursor: pointer;
        color: var(--text-secondary, #64748b);
        transition: all 0.2s ease;
        font-size: 0.8rem;
      }
      
      .tips-toggle:hover {
        background: var(--bg-primary, #ffffff);
        color: var(--primary-color, #3b82f6);
        transform: scale(1.1);
      }
      
      /* Collapsible quick tip - Generated by Copilot */
      .quick-tip {
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        color: white;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 0.5rem;
        margin: 0.5rem 1rem;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
      }
      
      .quick-tip.collapsed {
        max-height: 0;
        margin: 0 1rem;
        opacity: 0;
        transform: translateY(-10px);
      }
      
      .quick-tip:not(.collapsed) {
        max-height: 4rem;
        opacity: 1;
        transform: translateY(0);
      }
      
      .quick-tip-content {
        padding: 0.75rem 1rem;
        font-size: 0.8rem;
        line-height: 1.4;
      }
      
      .quick-tip kbd {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-family: 'Inter', monospace;
        font-size: 0.7rem;
        font-weight: 600;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
        /* Mobile optimizations */
      @media (max-width: 768px) {
        .input-footer.compact {
          padding: 0.375rem 0.75rem;
          min-height: 1.75rem;
        }
        
        .quick-tip-content {
          padding: 0.5rem 0.75rem;
          font-size: 0.75rem;
        }
        
        .char-count {
          font-size: 0.7rem;
        }
      }
        /* Context Panel Toggle - Generated by Copilot */
      .context-panel {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        background: var(--bg-primary, #ffffff);
        border-left: 1px solid var(--border-color, #e2e8f0);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      .context-panel.collapsed {
        flex: 0 0 0 !important;
        min-width: 0 !important;
        transform: translateX(100%);
        opacity: 0;
      }
      
      .context-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: var(--bg-secondary, #f8fafc);
        border-bottom: 1px solid var(--border-color, #e2e8f0);
        position: sticky;
        top: 0;
        z-index: 10;
      }
      
      .context-header-left {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: var(--text-primary, #1e293b);
      }
      
      .context-header-left i {
        color: var(--primary-color, #3b82f6);
      }
      
      .context-header-right {
        display: flex;
        align-items: center;
      }
      
      .context-toggle {
        background: none;
        border: none;
        padding: 0.5rem;
        border-radius: 0.375rem;
        cursor: pointer;
        color: var(--text-secondary, #64748b);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
      }
      
      .context-toggle:hover {
        background: var(--bg-primary, #ffffff);
        color: var(--primary-color, #3b82f6);
        transform: scale(1.1);
      }
      
      .context-toggle i {
        transition: transform 0.3s ease;
      }
      
      .context-panel.collapsed .context-toggle i {
        transform: rotate(180deg);
      }
      
      /* Context panel floating button when collapsed */
      .context-panel.collapsed::before {
        content: '';
        position: absolute;
        left: -40px;
        top: 50%;
        transform: translateY(-50%);
        width: 32px;
        height: 60px;
        background: var(--primary-color, #3b82f6);
        border-radius: 0.5rem 0 0 0.5rem;
        cursor: pointer;
        z-index: 20;
        box-shadow: -2px 0 8px rgba(59, 130, 246, 0.2);
        transition: all 0.2s ease;
      }
      
      .context-panel.collapsed::after {
        content: '📊';
        position: absolute;
        left: -32px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        cursor: pointer;
        z-index: 21;
        transition: all 0.2s ease;
      }
      
      .context-panel.collapsed:hover::before {
        background: var(--primary-hover, #2563eb);
        transform: translateY(-50%) scale(1.05);
      }
        /* Responsive context panel */
      @media (max-width: 1024px) {
        .polymind-workspace {
          position: relative;
        }
        
        .context-panel {
          position: fixed;
          right: 0;
          top: 0;
          height: 100vh;
          width: 320px;
          z-index: 1000;
          background: var(--bg-primary, #ffffff);
          box-shadow: -4px 0 16px rgba(0, 0, 0, 0.1);
          flex: none;
        }
        
        .context-panel.collapsed {
          transform: translateX(100%);
          opacity: 0;
        }
        
        .context-panel.collapsed::before {
          left: -48px;
          width: 40px;
          height: 80px;
        }
        
        .context-panel.collapsed::after {
          left: -36px;
          font-size: 1.2rem;
        }
        
        /* Chat interface takes full width on mobile */
        .chat-interface {
          flex: 1;
          width: 100%;
        }
      }
    </style>
  </head>
  <body data-theme="dark">
    <!-- Welcome Carousel (Initial Onboarding) -->
    <div class="welcome-carousel" id="welcome-carousel">
      <div class="carousel-content">
        <i class="fas fa-brain"></i>
        <h2>Welcome to POLYMIND</h2>
        <p>
          Your intelligent AI assistant, ready to revolutionize the way you
          work. Fast, smart, and secure.
        </p>
      </div>
      <div class="carousel-pagination">
        <span class="carousel-dot active" data-slide="0"></span>
        <span class="carousel-dot" data-slide="1"></span>
        <span class="carousel-dot" data-slide="2"></span>
      </div>
      <button class="start-chat-btn" id="start-chat-btn">
        Start Chatting Now
      </button>
    </div>

    <div class="polymind-workspace" id="polymind-workspace">
      <!-- Sidebar Overlay for Mobile -->
      <div class="sidebar-overlay" id="sidebar-overlay"></div>

      <!-- ===== 1. SIDEBAR ===== -->
      <aside class="sidebar">
        <header class="sidebar-header">
          <span class="logo"><i class="fas fa-brain"></i>POLYMIND</span>
          <button
            class="close-sidebar-btn"
            id="close-sidebar-btn"
            title="Close Sidebar"
          >
            <i class="fas fa-times"></i>
          </button>
        </header>

        <button class="new-chat-btn">
          <i class="fas fa-plus"></i> New Chat
        </button>        <!-- Agent Selector -->
        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Active Agent</h3>
          <div class="agent-selector-wrapper">            <select id="agentSelector" class="agent-selector">
              <option value="deepseek">DeepSeek V3</option>
              <option value="coding">Coding Expert</option>
              <option value="analysis">Data Analyst</option>
              <option value="creative">Creative Writer</option>
            </select>
          </div>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Conversations</h3>
          <ul class="nav-list" id="conversation-list">
            <li>
              <a href="#" class="active" data-conv-id="1"
                ><i class="fas fa-comment"></i> X-25 Report Analysis</a
              >
            </li>
            <li>
              <a href="#" data-conv-id="2"
                ><i class="fas fa-comment"></i> Logistics Planning</a
              >
            </li>
            <li>
              <a href="#" data-conv-id="3"
                ><i class="fas fa-comment"></i> Document Translation</a
              >
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">AI Agents</h3>
          <ul class="nav-list" id="agent-list">
            <li>
              <a href="#" data-agent="Strategos"
                ><i class="fas fa-chess-king"></i> Strategos</a
              >
            </li>
            <li>
              <a href="#" data-agent="Analytica"
                ><i class="fas fa-chart-pie"></i> Analytica</a
              >
            </li>
            <li>
              <a href="#" data-agent="Logistix"
                ><i class="fas fa-truck"></i> Logistix</a
              >
            </li>
            <li>
              <a href="#" data-agent="Linguist"
                ><i class="fas fa-language"></i> Linguist</a
              >
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Knowledge Base</h3>
          <ul class="nav-list" id="knowledge-base-list">
            <li>
              <a href="#"><i class="fas fa-file-alt"></i> Report_X-25.pdf</a>
            </li>
            <li>
              <a href="#"><i class="fas fa-file-word"></i> Supply_Chain.docx</a>
            </li>
            <li>
              <a href="#"><i class="fas fa-database"></i> Personnel_DB.sql</a>
            </li>
          </ul>
        </div>

        <footer class="sidebar-footer">
          <div class="user-profile">
            <img src="https://i.pravatar.cc/80?u=commander" alt="User Avatar" />
            <div class="user-info">
              <span class="name">Commander Bravo</span>
              <span class="role">Administrator</span>
            </div>
          </div>
          <div class="global-settings">
            <button title="Change Language">
              <i class="fas fa-globe"></i> EN
            </button>
            <button title="Help & Support">
              <i class="fas fa-question-circle"></i> Help
            </button>
            <button title="Settings" id="theme-toggle">
              <i class="fas fa-cog"></i> Settings
            </button>
          </div>
        </footer>
      </aside>

      <!-- ===== 2. CHAT INTERFACE ===== -->
      <main class="chat-interface">
        <header class="chat-header">          <div class="chat-header-left">
            <button
              class="mobile-menu-toggle"
              id="mobile-menu-toggle"
              title="Open Sidebar"
            >
              <i class="fas fa-bars"></i>
            </button>
            <div class="chat-header-title" id="chat-header-title">
              <i class="fas fa-chess-king"></i>
              <span>Chat with Strategos</span>
            </div>
            <!-- Connection Status -->
            <div class="connection-status connected" 
                 id="connectionStatus" 
                 role="status" 
                 aria-live="polite"
                 aria-label="Connection status"
                 data-status="connected">
              <span class="status-dot" aria-hidden="true"></span>
              <span class="status-text" id="statusText">Đã kết nối</span>
            </div>
          </div>
          <div class="chat-header-actions">
            <button title="Agent Info">
              <i class="fas fa-info-circle"></i>
            </button>
            <button title="Export Chat"><i class="fas fa-download"></i></button>
            <button title="Clear Chat"><i class="fas fa-trash-alt"></i></button>
          </div>
        </header>

        <div class="chat-log" id="chat-log">          <!-- AI Welcome Message -->
          <div class="chat-message ai">
            <div class="avatar"><i class="fas fa-robot"></i></div>
            <div class="message-content">
              <p>
                Strategos ready for commands. How can I assist with your
                mission?
              </p>
              <span class="message-meta">Strategos • <span id="welcomeTime">--:--:--</span></span>
            </div>
          </div>

          <!-- User Message Example -->
          <div class="chat-message user">
            <div class="avatar">CB</div>
            <div class="message-content">
              <p>
                Analyze key strengths and weaknesses in X-25 Report. Propose 3
                strategic action plans.
              </p>
              <div class="message-actions">
                <button><i class="fas fa-thumbs-up"></i></button>
                <button><i class="fas fa-thumbs-down"></i></button>
                <button>Revise</button>
              </div>
              <span class="message-meta">Commander Bravo • 10:32</span>
            </div>
          </div>

          <!-- AI Typing Indicator (Template) -->
          <div
            class="chat-message ai typing-indicator"
            id="typing-indicator"
            style="display: none"
          >
            <div class="avatar"><i class="fas fa-robot"></i></div>
            <div class="message-content">
              <div class="typing-indicator">
                <span></span><span></span><span></span>
              </div>
            </div>
          </div>
        </div>

        <div class="chat-input-area">
          <div class="quick-reply-suggestions" id="quick-reply-suggestions">
            <button>Một số tips để coding nhanh chuyên nghiệp</button>
            <button>Trích đoạn hay nhất trong Hamlet là gì?</button>
            <button>Kiến trúc phần mềm bền vững là gì?</button>
          </div>
          <form class="chat-input-form" id="chat-form">
            <button type="button" title="Voice Input">
              <i class="fas fa-microphone"></i>
            </button>
            <textarea
              id="chat-input"
              placeholder="You need help today?"
              rows="1"
            ></textarea>
            <div class="input-actions">
              <button type="button" title="Attach File">
                <i class="fas fa-paperclip"></i>
              </button>
              <button type="button" title="Emoji">
                <i class="fas fa-smile"></i>
              </button>
              <button type="submit" class="send-btn" title="Send (Enter)">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>          </form>
          
          <!-- Compact input footer - Generated by Copilot -->
          <div class="input-footer compact">
            <div class="input-footer-left">
              <span class="char-count" id="charCount">0/2000</span>
            </div>
            <div class="input-footer-right">
              <button class="tips-toggle" id="tips-toggle" title="Show/Hide Tips">
                <i class="fas fa-lightbulb"></i>
              </button>
            </div>
          </div>
            <!-- Collapsible quick tip - Generated by Copilot -->
          <div class="quick-tip collapsed" id="quick-tip">
            <div class="quick-tip-content">
              <strong>💡 Quick Tips:</strong> 
              Type <kbd>@</kbd> to call a command • <kbd>/</kbd> for command list • <kbd>Enter</kbd> to send • <kbd>Shift+Enter</kbd> for new line • <kbd>Ctrl+I</kbd> toggle info panel • <kbd>Ctrl+?</kbd> toggle tips
            </div>
          </div>
        </div>
      </main>      <!-- ===== 3. CONTEXT PANEL ===== -->
      <aside class="context-panel" id="context-panel">
        <header class="context-header">
          <div class="context-header-left">
            <i class="fas fa-info-circle"></i> 
            <span>Agent Information</span>
          </div>
          <div class="context-header-right">
            <button class="context-toggle" id="context-toggle" title="Toggle Agent Information">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
        </header>
        <div class="context-content" id="context-content">
          <!-- Content will be dynamically inserted here by JS -->
        </div>
      </aside>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const chatLog = document.getElementById("chat-log");
        const chatForm = document.getElementById("chat-form");
        const chatInput = document.getElementById("chat-input");
        const typingIndicator = document.getElementById("typing-indicator");
        const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
        const closeSidebarBtn = document.getElementById("close-sidebar-btn");
        const workspace = document.getElementById("polymind-workspace");
        const sidebarOverlay = document.getElementById("sidebar-overlay");
        const agentLinks = document.querySelectorAll("#agent-list a");
        const conversationLinks = document.querySelectorAll(
          "#conversation-list a"
        ); // New
        const chatHeaderTitleSpan = document
          .getElementById("chat-header-title")
          .querySelector("span");
        const chatHeaderIcon = document
          .getElementById("chat-header-title")
          .querySelector("i");
        const contextPanel = document.getElementById("context-panel");
        const contextContent = document.getElementById("context-content");        const quickReplySuggestions = document.getElementById(
          "quick-reply-suggestions"
        );        const themeToggleBtn = document.getElementById("theme-toggle");
        const tipsToggleBtn = document.getElementById("tips-toggle");
        const quickTip = document.getElementById("quick-tip");
        const charCount = document.getElementById("charCount");
        const contextToggleBtn = document.getElementById("context-toggle");

        const welcomeCarousel = document.getElementById("welcome-carousel");
        const startChatBtn = document.getElementById("start-chat-btn");
        const carouselDots = document.querySelectorAll(".carousel-dot");

        // --- Agent Information Database ---
        const agentDatabase = {
          Strategos: {
            icon: "fa-chess-king",
            description:
              "Specialized in strategic planning, intelligence analysis, and scenario simulation. Optimized for high-level decision making.",
            capabilities: [
              "SWOT Analysis",
              "Scenario Simulation",
              "Campaign Planning",
              "Risk Management",
            ],
            quickReplies: [
            "Một số tips để coding nhanh chuyên nghiệp",
            "Trích đoạn hay nhất trong Hamlet là gì?",
            "Kiến trúc phần mềm bền vững là gì?"
            ],
          },
          Analytica: {
            icon: "fa-chart-pie",
            description:
              "Focused on big data analysis, pattern recognition, and complex information visualization.",
            capabilities: [
              "Big Data Processing",
              "Predictive Analytics",
              "Entity Recognition",
              "Data Visualization",
            ],
            quickReplies: [
              "Show me data trends.",
              "Analyze this dataset.",
              "Identify key outliers.",
            ],
          },
          Logistix: {
            icon: "fa-truck",
            description:
              "Manages and optimizes supply chains, resource coordination, and logistics planning.",
            capabilities: [
              "Route Optimization",
              "Inventory Management",
              "Demand Forecasting",
              "Asset Coordination",
            ],
            quickReplies: [
              "Optimize delivery routes.",
              "Check inventory levels.",
              "Forecast demand for Q3.",
            ],
          },
          Linguist: {
            icon: "fa-language",
            description:
              "Specializes in translation, natural language processing, and multilingual text analysis in real-time.",
            capabilities: [
              "Military-grade Translation",
              "Text Summarization",
              "Sentiment Analysis",
              "Multilingual Communication",
            ],
            quickReplies: [
              "Translate this text.",
              "Summarize this document.",
              "Analyze sentiment here.",
            ],
          },
        };        // --- State ---
        let currentAgent = "Strategos"; // Default agent
        let currentTheme = localStorage.getItem("theme") || "dark"; // Get theme from localStorage or default to dark
        let currentCarouselSlide = 0;
        let websocket = null; // WebSocket connection - Generated by Copilot
        let isConnected = false; // Connection status
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 5;
        
        const carouselSlides = [
          {
            icon: "fas fa-brain",
            title: "Welcome to POLYMIND",
            text: "Your intelligent AI assistant, ready to revolutionize the way you work. Fast, smart, and secure.",
          },
          {
            icon: "fas fa-rocket",
            title: "Boost Your Productivity",
            text: "Leverage specialized AI agents for strategic planning, data analysis, logistics, and more.",
          },
          {
            icon: "fas fa-shield-alt",
            title: "Secure & Reliable",
            text: "Your data is protected with military-grade encryption. Focus on your mission, we handle the rest.",
          },
        ];        // --- Functions ---

        /**
         * Initialize WebSocket connection - Generated by Copilot
         */
        const connectWebSocket = () => {
          const wsUrl = `ws://${window.location.host}/ws/chat`;
          
          try {
            console.log(`🔌 [WebSocket] Attempting to connect to: ${wsUrl}`);
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = () => {
              console.log('✅ [WebSocket] Connection established successfully');
              isConnected = true;
              reconnectAttempts = 0;
              updateConnectionStatus(true);
            };

            websocket.onmessage = (event) => {
              console.log('📥 [WebSocket] Message received:', event.data);
              
              try {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
              } catch (parseError) {
                console.error('❌ [WebSocket] Failed to parse message:', parseError);
              }
            };

            websocket.onclose = () => {
              console.log('❌ [WebSocket] Connection closed');
              isConnected = false;
              updateConnectionStatus(false);
              attemptReconnect();
            };

            websocket.onerror = (error) => {
              console.error('❌ [WebSocket] Error:', error);
            };

          } catch (error) {
            console.error('❌ [WebSocket] Failed to create connection:', error);
          }
        };

        /**
         * Handle incoming WebSocket messages - Generated by Copilot
         */
        const handleWebSocketMessage = (data) => {
          // Hide typing indicator
          typingIndicator.style.display = "none";
          
          // Handle format từ server: {"sender": "ai", "message": "..."}
          if (data.sender && data.message) {
            console.log('💬 [WebSocket] Handling server response:', {
              sender: data.sender,
              messagePreview: data.message.substring(0, 100) + (data.message.length > 100 ? '...' : '')
            });
            
            switch(data.sender) {
              case 'ai':
                addMessage("ai", data.message, true);
                break;
              case 'system':
                addMessage("ai", data.message, false);
                break;
              default:
                addMessage("ai", data.message, true);
                break;
            }
            return;
          }
          
          // Fallback for other formats
          console.warn('❓ [WebSocket] Unknown message format:', data);
        };

        /**
         * Attempt to reconnect WebSocket - Generated by Copilot
         */
        const attemptReconnect = () => {
          if (reconnectAttempts < maxReconnectAttempts) {
            reconnectAttempts++;
            setTimeout(() => {
              console.log(`🔄 Reconnect attempt ${reconnectAttempts}/${maxReconnectAttempts}`);
              connectWebSocket();
            }, 2000 * reconnectAttempts);
          }
        };

        /**
         * Update connection status UI - Generated by Copilot
         */
        const updateConnectionStatus = (connected) => {
          const connectionStatus = document.getElementById('connectionStatus');
          const statusText = document.getElementById('statusText');
          
          if (connectionStatus) {
            connectionStatus.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
          }
          
          if (statusText) {
            statusText.textContent = connected ? 'Đã kết nối' : 'Mất kết nối';
          }
        };

        /**
         * Send message via WebSocket - Generated by Copilot
         */
        const sendMessage = (userInput) => {
          // Check WebSocket connection
          if (!websocket || websocket.readyState !== WebSocket.OPEN) {
            addMessage("ai", "Kết nối bị gián đoạn. Đang thử kết nối lại...", false);
            connectWebSocket();
            return;
          }

          // Show typing indicator
          typingIndicator.style.display = "flex";
          scrollToBottom();

          try {
            // Send message với format mà server expect
            const messageData = {
              message: userInput,  // Server expect key 'message'
              agent: currentAgent,
              timestamp: new Date().toISOString()
            };
            
            console.log('📤 [WebSocket] Sending message:', messageData);
            websocket.send(JSON.stringify(messageData));
            
          } catch (error) {
            console.error('❌ [WebSocket] Error sending message:', error);
            typingIndicator.style.display = "none";
            addMessage("ai", "Lỗi khi gửi tin nhắn. Vui lòng thử lại.", false);
          }
        };

        /**
         * Smoothly scrolls the chat log to the bottom
         */
        const scrollToBottom = () => {
          setTimeout(() => {
            chatLog.scrollTop = chatLog.scrollHeight;
          }, 50);
        };

        /**
         * Appends a message to the chat log
         * @param {string} sender - 'user' or 'ai'
         * @param {string} text - The message content
         * @param {boolean} showFeedback - Whether to show feedback buttons for AI messages
         */
        const addMessage = (sender, text, showFeedback = false) => {
          const messageEl = document.createElement("div");
          messageEl.classList.add("chat-message", sender);

          const avatarContent =
            sender === "user" ? "CB" : '<i class="fas fa-robot"></i>';
          const senderName =
            sender === "user" ? "Commander Bravo" : currentAgent;
          const time = new Date().toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          let feedbackHtml = "";
          if (sender === "ai" && showFeedback) {
            feedbackHtml = `
                <div class="message-actions">
                    <button class="feedback-btn" data-feedback="up" title="Good response"><i class="fas fa-thumbs-up"></i></button>
                    <button class="feedback-btn" data-feedback="down" title="Poor response"><i class="fas fa-thumbs-down"></i></button>
                    <button class="feedback-btn" data-feedback="revise" title="Suggest revision">Revise</button>
                </div>
            `;
          }

          messageEl.innerHTML = `
            <div class="avatar">${avatarContent}</div>
            <div class="message-content">
                <p>${text}</p>
                ${feedbackHtml}
                <span class="message-meta">${senderName} • ${time}</span>
            </div>        `;
          chatLog.appendChild(messageEl);
          
          // Smooth scroll to bottom
          scrollToBottom();

          // Add event listeners for feedback buttons
          if (sender === "ai" && showFeedback) {
            messageEl.querySelectorAll(".feedback-btn").forEach((button) => {
              button.addEventListener("click", (e) => {
                alert(
                  `Feedback recorded for AI message: ${e.currentTarget.dataset.feedback}`
                );
                // Disable buttons after feedback
                e.currentTarget.parentNode
                  .querySelectorAll("button")
                  .forEach((btn) => (btn.disabled = true));
              });
            });
          }
        };        /**
         * Simulates an AI response after a delay
         * DEPRECATED: Now using WebSocket instead - Generated by Copilot
         */        
        const simulateAIResponse = (userInput) => {
          // This function is now deprecated
          // WebSocket connection is used instead via sendMessage()
          console.warn('⚠️ simulateAIResponse is deprecated, using WebSocket instead');
        };

        /**
         * Updates the context panel with agent information
         */
        const updateContextPanel = (agentName) => {
          const agentInfo = agentDatabase[agentName];
          if (!agentInfo) {
            contextContent.innerHTML = `<div class="placeholder">No information available for this agent.</div>`;
            return;
          }

          const capabilitiesList = agentInfo.capabilities
            .map((cap) => `<li><i class="fas fa-check-circle"></i> ${cap}</li>`)
            .join("");

          contextContent.innerHTML = `
            <div class="agent-details">
                <div class="detail-item">
                    <strong>Description</strong>
                    <p>${agentInfo.description}</p>
                </div>
                <div class="detail-item">
                    <strong>Core Capabilities</strong>
                    <ul class="capabilities-list">${capabilitiesList}</ul>
                </div>
            </div>
        `;
        };

        /**
         * Updates the quick reply suggestions based on the current agent
         */
        const updateQuickReplySuggestions = (agentName) => {
          const agentInfo = agentDatabase[agentName];
          quickReplySuggestions.innerHTML = ""; // Clear existing
          if (agentInfo && agentInfo.quickReplies) {
            agentInfo.quickReplies.forEach((suggestion) => {
              const button = document.createElement("button");
              button.textContent = suggestion;
              button.addEventListener("click", () => {
                chatInput.value = suggestion;
                chatInput.dispatchEvent(new Event("input")); // Trigger resize
                chatInput.focus();
              });
              quickReplySuggestions.appendChild(button);
            });
          }
        };        /**
         * Handles form submission
         */
        if (chatForm) {
          chatForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const userInput = chatInput?.value.trim();
            if (userInput) {
              addMessage("user", userInput);
              chatInput.value = "";
              chatInput.style.height = "auto"; // Reset height
              sendMessage(userInput); // Use WebSocket instead of simulateAIResponse
            }
          });
        }        /**
         * Handles keyboard shortcuts - Enhanced with context panel toggle - Generated by Copilot
         */
        if (chatInput) {
          chatInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              chatForm?.dispatchEvent(new Event("submit"));
            }
          });
        }

        // Global keyboard shortcuts - Generated by Copilot
        document.addEventListener("keydown", (e) => {
          // Ctrl/Cmd + I to toggle context panel
          if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
            e.preventDefault();
            toggleContextPanel();
          }
          
          // Ctrl/Cmd + ? to toggle quick tips
          if ((e.ctrlKey || e.metaKey) && e.key === '?') {
            e.preventDefault();
            toggleQuickTips();
          }
        });/**
         * Auto-resizes the textarea and updates character count - Generated by Copilot
         */
        if (chatInput) {
          chatInput.addEventListener("input", () => {
            // Auto-resize
            chatInput.style.height = "auto";
            chatInput.style.height = `${chatInput.scrollHeight}px`;
            
            // Update character count
            updateCharacterCount();
          });
        }

        /**
         * Updates character count display - Generated by Copilot
         */
        const updateCharacterCount = () => {
          if (!chatInput || !charCount) return;
          
          const currentLength = chatInput.value.length;
          const maxLength = 2000;
          
          charCount.textContent = `${currentLength}/${maxLength}`;
          
          // Change color based on usage
          if (currentLength > maxLength * 0.9) {
            charCount.style.color = 'var(--danger-color, #ef4444)';
          } else if (currentLength > maxLength * 0.7) {
            charCount.style.color = 'var(--warning-color, #f59e0b)';
          } else {
            charCount.style.color = 'var(--text-secondary, #64748b)';
          }
        };

        /**
         * Toggles quick tips visibility - Generated by Copilot
         */
        const toggleQuickTips = () => {
          if (!quickTip || !tipsToggleBtn) return;
          
          const isCollapsed = quickTip.classList.contains('collapsed');
          
          if (isCollapsed) {
            // Show tips
            quickTip.classList.remove('collapsed');
            tipsToggleBtn.innerHTML = '<i class="fas fa-lightbulb"></i>';
            tipsToggleBtn.title = 'Hide Tips';
          } else {
            // Hide tips
            quickTip.classList.add('collapsed');
            tipsToggleBtn.innerHTML = '<i class="far fa-lightbulb"></i>';
            tipsToggleBtn.title = 'Show Tips';
          }
        };        // Add event listener for tips toggle
        if (tipsToggleBtn) {
          tipsToggleBtn.addEventListener('click', toggleQuickTips);
        }        /**
         * Toggles context panel visibility - Generated by Copilot
         */
        const toggleContextPanel = () => {
          if (!contextPanel || !contextToggleBtn) return;
          
          const isCollapsed = contextPanel.classList.contains('collapsed');
          
          if (isCollapsed) {
            // Show context panel
            contextPanel.classList.remove('collapsed');
            contextToggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            contextToggleBtn.title = 'Hide Agent Information';
            
            // Save preference
            localStorage.setItem('contextPanelCollapsed', 'false');
          } else {
            // Hide context panel
            contextPanel.classList.add('collapsed');
            contextToggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            contextToggleBtn.title = 'Show Agent Information';
            
            // Save preference
            localStorage.setItem('contextPanelCollapsed', 'true');
          }
          
          // Force layout recalculation - Generated by Copilot
          setTimeout(() => {
            if (chatLog) {
              chatLog.scrollTop = chatLog.scrollHeight;
            }
            
            // Trigger resize event to help any responsive components
            window.dispatchEvent(new Event('resize'));
          }, 300); // Match the CSS transition duration
        };

        // Add event listener for context toggle
        if (contextToggleBtn) {
          contextToggleBtn.addEventListener('click', toggleContextPanel);
        }

        // Add click listener for floating button when collapsed - Generated by Copilot
        if (contextPanel) {
          contextPanel.addEventListener('click', (e) => {
            // Check if click is on the pseudo-element area (floating button)
            const rect = contextPanel.getBoundingClientRect();
            const clickX = e.clientX;
            
            if (contextPanel.classList.contains('collapsed') && 
                clickX >= rect.left - 50 && clickX <= rect.left) {
              toggleContextPanel();
            }
          });
        }

        /**
         * Toggles the sidebar on mobile
         */
        const toggleSidebar = () => {
          workspace?.classList.toggle("sidebar-open");
        };
        
        if (mobileMenuToggle) {
          mobileMenuToggle.addEventListener("click", toggleSidebar);
        }
        if (closeSidebarBtn) {
          closeSidebarBtn.addEventListener("click", toggleSidebar);
        }
        if (sidebarOverlay) {
          sidebarOverlay.addEventListener("click", toggleSidebar);
        }

        /**
         * Handles switching between AI agents
         */
        agentLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();

            // Remove active class from all agent and conversation links
            agentLinks.forEach((l) => l.classList.remove("active"));
            conversationLinks.forEach((l) => l.classList.remove("active"));

            // Add active class to the clicked agent link
            link.classList.add("active");

            // Update state and UI
            currentAgent = link.dataset.agent;
            const agentInfo = agentDatabase[currentAgent];

            chatHeaderTitleSpan.textContent = `Chat with ${currentAgent}`;
            chatHeaderIcon.className = `fas ${agentInfo.icon}`;

            // Clear chat and add welcome message
            chatLog.innerHTML = "";
            addMessage(
              "ai",
              `Agent ${currentAgent} ready for commands. How may I assist you?`
            );

            // Update context panel
            updateContextPanel(currentAgent);

            // Update quick reply suggestions
            updateQuickReplySuggestions(currentAgent);

            // Close sidebar on mobile after selection
            if (workspace.classList.contains("sidebar-open")) {
              toggleSidebar();
            }
          });
        });

        /**
         * Handles switching between conversations (dummy functionality)
         */
        conversationLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();

            // Remove active class from all agent and conversation links
            agentLinks.forEach((l) => l.classList.remove("active"));
            conversationLinks.forEach((l) => l.classList.remove("active"));

            // Add active class to the clicked conversation link
            link.classList.add("active");

            const convName = link.textContent.trim();
            chatHeaderTitleSpan.textContent = convName;
            chatHeaderIcon.className = `fas fa-comment`; // Generic icon for conversations

            // Simulate loading conversation history
            chatLog.innerHTML = "";
            addMessage("ai", `Loading conversation: "${convName}".`);
            setTimeout(() => {
              addMessage("user", `What did we discuss about ${convName}?`);
              setTimeout(() => {
                addMessage(
                  "ai",
                  `In this conversation, we focused on the key aspects of "${convName}". What specific details are you looking for?`
                );
              }, 1000);
            }, 500);

            // Clear context panel for general conversations
            contextContent.innerHTML = `<div class="placeholder">This is a general conversation. Select an AI Agent to see its details.</div>`;
            quickReplySuggestions.innerHTML = ""; // Clear quick replies for general chat
            if (workspace.classList.contains("sidebar-open")) {
              toggleSidebar();
            }
          });
        });

        /**
         * Toggles between dark and light themes
         */
        const toggleTheme = () => {
          const newTheme =
            document.body.dataset.theme === "dark" ? "light" : "dark";
          document.body.dataset.theme = newTheme;
          localStorage.setItem("theme", newTheme);
          // Update the icon for theme toggle button
          themeToggleBtn.querySelector("i").className =
            newTheme === "dark" ? "fas fa-moon" : "fas fa-sun";
        };
        themeToggleBtn.addEventListener("click", toggleTheme);

        /**
         * Welcome Carousel Logic
         */
        const updateCarouselSlide = (index) => {
          currentCarouselSlide = index;
          const slide = carouselSlides[index];
          welcomeCarousel.querySelector(".carousel-content i").className =
            slide.icon;
          welcomeCarousel.querySelector(".carousel-content h2").textContent =
            slide.title;
          welcomeCarousel.querySelector(".carousel-content p").textContent =
            slide.text;

          carouselDots.forEach((dot, idx) => {
            if (idx === index) {
              dot.classList.add("active");
            } else {
              dot.classList.remove("active");
            }
          });
        };

        carouselDots.forEach((dot) => {
          dot.addEventListener("click", (e) => {
            const slideIndex = parseInt(e.target.dataset.slide);
            updateCarouselSlide(slideIndex);
          });
        });

        startChatBtn.addEventListener("click", () => {
          welcomeCarousel.classList.add("hidden");
          // Ensure initial chat agent and conversation are active
          document
            .querySelector('#agent-list a[data-agent="Strategos"]')
            .click();
        });        // --- Initial Setup ---

        // Initialize WebSocket connection - Generated by Copilot
        connectWebSocket();
        
        // Initialize character count - Generated by Copilot
        updateCharacterCount();
          // Initialize quick tips as collapsed by default - Generated by Copilot
        if (quickTip) {
          quickTip.classList.add('collapsed');
        }
        if (tipsToggleBtn) {
          tipsToggleBtn.innerHTML = '<i class="far fa-lightbulb"></i>';
          tipsToggleBtn.title = 'Show Tips';
        }
        
        // Initialize context panel state from localStorage - Generated by Copilot
        const contextPanelCollapsed = localStorage.getItem('contextPanelCollapsed');
        if (contextPanelCollapsed === 'true') {
          contextPanel?.classList.add('collapsed');
          if (contextToggleBtn) {
            contextToggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            contextToggleBtn.title = 'Show Agent Information';
          }
        } else {
          contextPanel?.classList.remove('collapsed');
          if (contextToggleBtn) {
            contextToggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            contextToggleBtn.title = 'Hide Agent Information';
          }
        }

        // Apply saved theme
        document.body.dataset.theme = currentTheme;
        themeToggleBtn.querySelector("i").className =
          currentTheme === "dark" ? "fas fa-moon" : "fas fa-sun";

        // Check if user has visited before or if it's explicitly set to skip carousel
        const hasVisited = localStorage.getItem("hasVisitedPolymind");
        if (!hasVisited) {
          welcomeCarousel.classList.remove("hidden");
          updateCarouselSlide(0); // Show first slide initially
          localStorage.setItem("hasVisitedPolymind", "true");
        } else {
          welcomeCarousel.classList.add("hidden");
          // If no carousel, ensure initial agent and context are set up
          updateContextPanel(currentAgent);
          updateQuickReplySuggestions(currentAgent);
          // Set Strategos as active by default if starting directly in chat
          document
            .querySelector('#agent-list a[data-agent="Strategos"]')
            .classList.add("active");        }
      });
    </script>
    <!-- Removed chat.js import to avoid conflicts - Generated by Copilot -->
    <!-- Chat.html now has its own inline WebSocket implementation -->
  </body>
</html>
